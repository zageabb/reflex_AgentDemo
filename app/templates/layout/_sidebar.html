<div class="scenario-sidebar card border-0 shadow-sm h-100">
  <div class="card-body p-3 p-xl-4 d-flex flex-column gap-3">
    <div class="d-flex align-items-center justify-content-between">
      <div>
        <p class="text-uppercase text-muted fw-semibold small mb-1">Scenario Library</p>
        <h2 class="h4 mb-0">Agents Factory</h2>
      </div>
      <span class="badge text-bg-primary-subtle text-primary-emphasis">
        <i class="fa-solid fa-layer-group me-1"></i>{{ scenarios | length }}
      </span>
    </div>

    <label class="visually-hidden" for="scenario-search">Search scenarios</label>
    <div class="input-group input-group-sm shadow-sm">
      <span class="input-group-text bg-body-secondary border-0">
        <i class="fa-solid fa-magnifying-glass"></i>
      </span>
      <input
        class="form-control border-0"
        id="scenario-search"
        name="search"
        placeholder="Search by title, description, or tag"
        type="search"
        value="{{ search_term }}"
        autocomplete="off"
      />
    </div>

    <ul class="nav nav-pills flex-wrap gap-2 small fw-semibold" id="scenario-category-tabs">
      <li class="nav-item">
        <button class="nav-link active" data-category-tab="__all__" type="button">
          <i class="fa-solid fa-border-all me-1"></i>All
        </button>
      </li>
      {% for category, items in scenario_groups.items() %}
        <li class="nav-item">
          <button class="nav-link" data-category-tab="{{ category }}" type="button">
            {{ category }}
          </button>
        </li>
      {% endfor %}
    </ul>

    <div class="scenario-scroll pe-1" id="scenario-scroll" style="overflow-y: auto;">
      {% if scenario_groups %}
        <div class="d-flex flex-column gap-4" id="scenario-groups">
          {% for category, items in scenario_groups.items() %}
            <section class="d-flex flex-column gap-2" data-category-panel="{{ category }}">
              <header class="d-flex align-items-center justify-content-between">
                <h3 class="h6 mb-0 text-muted">{{ category }}</h3>
                <span class="badge rounded-pill text-bg-light">{{ items | length }}</span>
              </header>
              <div class="d-grid gap-2 scenario-grid">
                {% for scenario in items %}
                  {% set search_string = (scenario.title ~ ' ' ~ scenario.description ~ ' ' ~ (scenario.tags | join(' '))) | lower %}
                  <a
                    class="card border shadow-sm scenario-card text-reset text-decoration-none {% if scenario.id == selected_scenario_id %}active border-primary{% endif %}"
                    href="{{ url_for('main.index', scenario=scenario.id) }}"
                    data-launch-scenario="true"
                    data-scenario-card
                    data-scenario-category="{{ category }}"
                    data-scenario-description="{{ scenario.description }}"
                    data-scenario-filename="{{ scenario.filename }}"
                    data-scenario-id="{{ scenario.id }}"
                    data-scenario-tags="{{ scenario.tags | join(' ') }}"
                    data-scenario-title="{{ scenario.title }}"
                    data-search-text="{{ search_string }}"
                    aria-current="{{ 'true' if scenario.id == selected_scenario_id else 'false' }}"
                  >
                    <div class="card-body">
                      <div class="d-flex align-items-start justify-content-between">
                        <h4 class="h6 mb-1">{{ scenario.title }}</h4>
                        <span class="text-primary-emphasis">
                          <i class="fa-solid fa-circle-play"></i>
                        </span>
                      </div>
                      {% if scenario.description %}
                        <p class="mb-2 text-muted small">{{ scenario.description }}</p>
                      {% endif %}
                      {% if scenario.tags %}
                        <div class="d-flex flex-wrap gap-1">
                          {% for tag in scenario.tags %}
                            <span class="badge rounded-pill text-bg-light border">{{ tag }}</span>
                          {% endfor %}
                        </div>
                      {% endif %}
                    </div>
                  </a>
                {% endfor %}
              </div>
            </section>
          {% endfor %}
        </div>
      {% else %}
        <div class="alert alert-info mb-0">
          No scenarios have been added yet. Create one from the admin dashboard to get started.
        </div>
      {% endif %}
    </div>

    <div class="alert alert-warning mb-0 d-none" id="scenario-no-results" role="status">
      <i class="fa-solid fa-triangle-exclamation me-2"></i>No scenarios match your search.
    </div>
  </div>
</div>
